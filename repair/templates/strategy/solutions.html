{% load i18n %}
{% block content %}

<!--setup solutions-->
<script type="text/template" id="solutions-setup-template">
<div class="row bordered">
  <h4 style="margin-right: 10px; float: left;">{% trans "Solution" %}</h4>
  <select name="solutions" class="selectpicker" style="max-width: 500px; margin-right: 10px; float: left;">
  </select>
  <button id="edit-solution" class="btn btn-primary"> {% trans "Edit" %} </button>
  <button id="add-solution" class="btn btn-primary"> {% trans "New" %} </button>
  <button id="delete-solution" class="btn btn-warning"> {% trans "Delete" %} </button>
</div>
<div id="solution-edit-content" class="row bordered sunken" style="display: none;">
  <div class="row">
    <button id='save-solution' title="{% trans "upload changes made to filter" %}" class="btn btn-danger btn-upload">
      <span class="glyphicon glyphicon-upload"></span> {% trans "Save Changes" %}
    </button>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="row">
        <label>{% trans "Name" %} </label>
        <input class="form-control" name="name">
      </div>
      <div class="row">
        <label>{% trans "Category" %} </label>
        <select name="solution-category" class="form-control"></select>
      </div>
      <button name="edit-solution-categories" class="btn btn-primary" title="{% trans "edit categories" %}">
        {% trans "Add/Edit Categories" %}
      </button>
      <div class="row" style="margin-top: 15px;">
        <label>{% trans "Description (visible in workshop mode)" %} </label>
        <div name="description"></div>
      </div>
    </div>
    <div class="col-md-6">
      <label>{% trans "Diagrams (visible in workshop mode)" %} </label>
      <div class="row bordered">
        <div class="row">
          <h4>{% trans "Current process" %}</h4>
          <input type="file" name="state-file" accept=".gif,.jpg,.jpeg,.png">
        </div>
        <div style="position: relative; ">
          <div class="row" style="background: white; overflow: auto; min-height: 200px;">
            <img id="state-image" src='' style="max-height: 300px;" alt="{% trans "Current process" %}">
          </div>
        </div>
        <div class="row">
          <h4>{% trans "Proposed process" %}</h4>
          <input type="file" name="effect-file" accept=".gif,.jpg,.jpeg,.png">
        </div>
        <div style="position: relative; ">
          <div class="row" style="background: white; overflow: auto; min-height: 200px;">
            <img id="effect-image" src='' style="max-height: 300px;" alt="{% trans "Proposed process" %}">
          </div>
        </div>
        <div class="row">
          <h4>{% trans "Activities involved" %}</h4>
          <input type="file" name="activities-file" accept=".gif,.jpg,.jpeg,.png">
        </div>
        <div style="position: relative; ">
          <div class="row" style="background: white; overflow: auto; min-height: 200px;">
            <img id="activities-image" src='' style="max-height: 300px;" alt="{% trans "Activities involved" %}">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="add-solution-modal" class="modal fade" role="dialog" style="z-index: 10000;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"> Add Solution </h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <label>{% trans "Name" %}</label>
          <input name="name" style="width: 100%;" style="margin-bottom: 10px;">
          <label>{% trans "Category" %}</label>
          <select name="solution-category" class="form-control" style="margin-bottom: 10px;"></select>
          <button name="edit-solution-categories" class="btn btn-primary add square" title="add part">
            <span class="glyphicon glyphicon-plus"></span> Add Category
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn cancel" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary confirm">OK</button>
      </div>
    </div>
  </div>
</div>
<div id="categories-modal" class="modal fade" role="dialog" style="z-index: 10000;"></div>
</script>

<!-- modal for editing categories -->
<script type="text/template" id="categories-template">
<div class="modal-dialog modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title">{% trans "Solution categories"%} in <i> <%= keyflowName %> </i></h4>
    </div>
    <div class="modal-body sunken">
      <div class="row category-list">
      </div>
      <button class="btn btn-primary add square" title="add category">
        <span class="glyphicon glyphicon-plus"></span> {% trans "Add Category" %}
      </button>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary confirm" data-dismiss="modal" aria-hidden="true">{% trans "OK"%}</button>
    </div>
  </div>
</div>
</script>

<!-- setup solution logic -->
<script type="text/template" id="solutions-logic-template">
<div class="row bordered">
  <h4 style="margin-right: 10px; float: left;">{% trans "Solution" %}</h4>
  <select name="solutions" style="max-width: 500px; margin-right: 10px; float: left;">
  </select>
  <button id="reload-solution-list" class="btn btn-primary round" style="margin-right: 10px; margin-left: -3px;">
    <span class="glyphicon glyphicon-refresh"></span>
  </button>
</div>
<div class="row sunken" id="solution-logic-content" style="visibility: hidden;">
  <div class="col-md-8">
    <ul class="nav nav-tabs">
      <li class="active"><a data-toggle="tab" href="#parts-tab">{% trans "Solution parts" %}</a></li>
      <li><a data-toggle="tab" href="#questions-tab">{% trans "Implementation questions" %}</a></li>
      <li><a data-toggle="tab" href="#area-tab">{% trans "Possible implementation area" %}</a></li>
    </ul>
    <div class="tab-content bordered" style="min-height: 500px;">
      <div class="tab-pane fade in active" id="parts-tab">
        <div class="row">
          <h4 style="margin-bottom: 20px">{% trans "Parts in computing order" %}</h4>
          <div class="row">
            <div id="solution-parts-panel" style="min-height: 100px; max-width: 600px;" class="item-panel bordered"></div>
          </div>
          <button id="add-solution-part" class="btn btn-primary add square" title="add part">
            <span class="glyphicon glyphicon-plus"></span> {% trans "Add Part" %}
          </button>
        </div>
      </div>
      <div class="tab-pane fade in" id="questions-tab">
        <div class="row">
          <div class="row">
            <div id="questions-panel" style="min-height: 100px; max-width: 600px;" class="item-panel bordered"></div>
          </div>
          <button id="add-question" class="btn btn-primary add square" title="add question">
            <span class="glyphicon glyphicon-plus"></span> {% trans "Add Question" %}
          </button>
        </div>
      </div>
      <div class="tab-pane fade in" id="area-tab">
        <div class="row">
          <div class="col-md-6">
            <h4>{% trans "Map View" %}</h4>
            <div name="area-map" style="min-height: 450px;"></div>
          </div>
          <div class="col-md-6">
            <h4>{% trans "Possible Implementation Area as GeoJSON" %}</h4>
            <div class="row">
              <textarea rows="20" name="implementation-area" style="width:100%; resize: vertical;"> </textarea>
            </div>
            <button style="float: left;" class="btn btn-tertiary" name="show-area" title="show area">
              Show
              <span class="glyphicon glyphicon-arrow-left" style="float: left; margin-right: 5px;"></span>
            </button>
            <button style="float: right;" class="btn btn-primary upload" name="implementation-area" title="Upload GeoJSON">
              Upload
              <span class="glyphicon glyphicon-upload" style="float: left; margin-right: 5px;"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4 bordered" style="margin-top: 10px; min-height: 550px;">
    <h4>{% trans "Notes (visible in setup mode only)" %} </h4>
    <textarea class="sunken bordered" rows="20" name="notes" style="width: 100%; resize: vertical;"></textarea>
  </div>
</div>
<div id="solution-part-modal" class="modal fade" role="dialog" style="z-index: 10000;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content col-md-12">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{% trans "Edit Solution Part" %}</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-basic cancel" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button class="btn btn-primary confirm" aria-hidden="true">{% trans "OK"%}</button>
      </div>
    </div>
  </div>
</div>
<div id="question-modal" class="modal fade" role="dialog" style="z-index: 10000;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content col-md-12">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{% trans "Edit Question" %}</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-basic cancel" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button class="btn btn-primary confirm" aria-hidden="true">{% trans "OK"%}</button>
      </div>
    </div>
  </div>
</div>
</script>

<!-- solution part-->
<script type="text/template" id="solution-part-template">
<div class="row">
  <label>{% trans "Name" %} </label>
  <input class="form-control" name="name">
</div>
<div class="row">
  <select name="impl-new-flow" class="form-control">
    <option value="false"> {% trans "This solution part modifies an existing flow." %}</option>
    <option value="true"> {% trans "This solution part creates a new flow (based on an existing flow)." %}</option>
  </select>
</div>
<ul class="nav nav-tabs" style="margin-top: 20px;">
  <li class="active"><a data-toggle="tab" href="#flow-tab">
    <div class="new-flow">{% trans "New Flow" %}</div>
    <div class="modified-flow">{% trans "Initial Impact Flow" %}</div>
  </a></li>
  <li><a data-toggle="tab" href="#formula-tab">{% trans "New Amount" %}</a></li>
  <li><a data-toggle="tab" href="#affected-flows-tab">{% trans "Possibly Affected Flows" %}</a></li>
</ul>
<div class="tab-content bordered">
  <div class="tab-pane fade in active" id="flow-tab">
    <div class="row modified-flow">
      <p style="max-width: 800px;">
        {% blocktrans %}
        The initial impact flow is the flow which the solution part modifies directly.
        As the solution definition does not include the implementation area and affected actors,
        the initial impact flow has to be defined on activity level.
        {% endblocktrans %}
      </p>
    </div>
    <div class="row new-flow">
      <h4> {% trans "Reference flow" %} </h4>
      <p style="max-width: 800px;">
        {% blocktrans %}
        The reference flow is the flow which the solution part uses as reference for defining the new flow.
        {% endblocktrans %}
      </p>
    </div>
    <div class="row">
      {% trans "Material" %}
      <div name="material" style="display: inline-block;"></div>
    </div>
    <div class="row">
      {% trans "going from activity" %}
      <select name="origin"></select>
      <input name="origin-in-area" type="checkbox">
      &nbsp;{% trans "activity has to be in the implementation area *)" %}
    </div>
    <div class="row">
      {% trans "to activity" %}
      <select name="destination"></select>
      <input name="destination-in-area" type="checkbox">
      &nbsp;{% trans "activity has to be in the implementation area *)" %}
    </div>
    <p style="font-size: 0.8em;">{% trans "*) defined by the users in the workshop mode when implementing the solution" %}</p>
    <br>
    <div class="row modified-flow">
      <p style="max-width: 800px;">
        {% blocktrans %}
        The change of the amount of the initial impact flow is defined on the next tab (“New amount”).
        For enabling the GDSE to model indirect changes of other flows derived from the amount changes of
        the initial impact flow, a list of all possibly affected flows (upstream and downstream) has to be
        defined in the tab “Possibly affected flows”.
        {% endblocktrans %}
      </p>
    </div>
    <div class="row new-flow">
      <h4> {% trans "New flow" %} </h4>
      <div style="max-width: 800px;">
        {% trans "The new flow keeps the" %}
        <select name="keep-origin" class="form-control" style="display: inline-block; width: 150px;">
          <option value="true"> {% trans "Origin" %} </option>
          <option value="false"> {% trans "Destination" %} </option>
        </select>
        {% trans "of the reference flow defined above." %} <br>
        {% trans "The" %}
        <div name="origdestlabel" style="display: inline;"></div>
        {% trans "activity of the reference flow is replaced with the activity" %}
        <select name="new-target" style="width: 100px;"></select>
        <br>
        <br>
        {% blocktrans %}
        When this solution is implemented by a user in the workshop mode, a specific actor with target activity above
        has to be selected on the map. Please phrase the request the user should read above the respective map
        (e.g. “Please select the recycling facility the collected material goes to.”)
        {% endblocktrans %}
        <textarea name="map-request" rows="2" style="width: 100%; resize: vertical;"></textarea>
      </div>
      <br>
      <p style="max-width: 800px;">
        {% blocktrans %}
        The volume of the new flow is defined on the next tab (“New amount”).
        For enabling the GDSE to model indirect changes of other flows derived from the new flow,
        a list of all possibly affected flows (upstream and downstream) has to be defined in the
        tab “Possibly affected flows”.
        {% endblocktrans %}
      </p>
    </div>
  </div>
  <div class="tab-pane fade in" id="affected-flows-tab">
    <p style="max-width: 800px;">
      {% blocktrans %}
      Please list all flows that could possibly be changed due to the changes of the initial impact flow caused by this solution part.
      Please include flows "downstream" as much as "upstream".
      {% endblocktrans %}
    </p>
    <p style="max-width: 800px;">
      {% blocktrans %}
      Flows not included in this list will be ignored when applying this solution part to the flow model algorithm and
      therefore not change their volume. All flow definitions in this list have to be on activity level.
      {% endblocktrans %}
    </p>
    <div id="affected-flows"></div>
    <button class="btn btn-primary add square">
      <span class="glyphicon glyphicon-plus"></span> {% trans "Add affected flow" %}
    </button>
  </div>
  <div class="tab-pane fade in" id="formula-tab">
    <div class="modified-flow">
     {% trans "Do you want to refer to a user question for calculating the flow modification?" %}
    </div>
    <div class="new-flow">
     {% trans "Do you want to refer to a user question for calculating the amount of the new flow?" %}
    </div>
    <select name='has-question' class="form-control" style="width: 100px; display: inline-block;">
        <option value="true"> {% trans "yes" %} </option>
        <option value="false"> {% trans "no" %} </option>
    </select>
    <br>
    <div class="row with-question">
      <label>{% trans "Question" %}</label>
      <select name='question' class="form-control"></select>
    </div>
    <div class="no-question">
      <div class="modified-flow">
        {% trans "Do you want to define the flow modification as an absolute or relative change?" %}
      </div>
      <div class="new-flow">
        {% trans "Do you want to define the amount of the new flow as an absolute or as a relative change of the amount of the reference flow?" %}
      </div>
      <select name="is-absolute" class="form-control" style="width: 100px; display: inline-block;">
        <option value="true"> {% trans "absolute" %} </option>
        <option value="false"> {% trans "relative" %} </option>
      </select>
    </div>
    <div class="row" style="margin-top: 15px; font-size: 1.2em;">
      <div class="modified-flow"> {% trans "Flow amount with solution impact = Flow amount in status quo" %} </div>
      <div class="new-flow"> {% trans "Amount of new flow = Amount of reference flow" %} </div>
      <div class="is-absolute"> &nbsp;+&nbsp;{% trans "Delta" %}</div>
      <div class="is-relative"> &nbsp;*&nbsp;{% trans "Factor" %}</div>
    </div>
    <div class="row" style="font-size: 1.2em;">
      <div class="is-absolute"> {% trans "Delta" %} </div>
      <div class="is-relative"> {% trans "Factor" %} </div>
      &nbsp;=&nbsp;
      <div class='with-question'>
        <input name='a' type="number" step="0.0001" style="display: inline-block; width: 150px;">
        &nbsp;*&nbsp;{% trans "answer to selected question" %}&nbsp;+&nbsp;
      </div>
      <input name='b' type="number" step="0.0001" style="display: inline-block; width: 150px;">
    </div>
    <div class="row">
    </div>
  </div>
</div>
</script>

<!-- affected flow row-->
<script type="text/template" id="affected-flow-row-template">
  {% trans "Material" %}
  <div name="material" style="width: 200px; display: inline-block;"></div>
  {% trans "from" %}
  <select name="origin" style="width: 200px; display: inline-block;"></select>
  {% trans "to" %}
  <select name="destination" style="width: 200px; display: inline-block;"></select>
  <button class="btn btn-warning square remove" title="remove affected flow">
    <span class="glyphicon glyphicon-minus"></span>
  </button>
</script>

<!-- question-->
<script type="text/template" id="question-template">
<div class="row">
  <label>{% trans "Question (as asked in workshop mode)" %} </label>
  <input class="form-control" name="question">
</div>
<br>
<div class="row">
  <label>{% trans "User's answer to this question are" %}</label>
  <br>
  {% trans "absolute values (t/year)" %} <input type="radio" name="is-absolute" value="true">
  <br>
  {% trans "relative values (Percentage)" %} <input type="radio" name="is-absolute" value="false">
</div>
<div class="row">
  <label> {% trans "and have to be in range" %} </label>
  <br>
  {% trans "min" %} <input name="min-value" min="0" type="number" style="display: inline-block; width: 150px; text-align: right;">
  <div name="unit" style="display: inline-block;">%</div>
  {% trans "and" %} {% trans "max" %} <input name="max-value" min="0" type="number" style="display: inline-block; width: 150px; text-align: right;">
  <div name="unit" style="display: inline-block;">%</div>
</div>
<div class="row">
  {% trans "with step size" %}
  <input name="step-size" min="0" type="number" style="display: inline-block; width: 150px; text-align: right;">
</script>

<script type="text/template" id="solutions-workshop-template">
<h3> {% trans "Solutions for the keyflow" %} <i><%= keyflowName %></i> </h3>
<div id="categories" class="row overflow">
</div>
<div id="solution-modal" class="modal fade" role="dialog" style="z-index: 10000;"></div>
</script>

<!-- modal for editing/viewing a solution and its charts -->
<script type="text/template" id="view-solution-template">
<div class="modal-dialog modal-lg" style="width: 80%; -webkit-transform: none; transform: none;">
  <!-- Modal content-->
  <div class="modal-content col-md-12">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title"><%= category %> - <%= name %></h4>
    </div>
    <div class="modal-body">
      <div class="row">
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#description-tab">{% trans "Description" %}</a></li>
          <li><a data-toggle="tab" href="#ce-diagrams-tab">{% trans "CE-Diagrams" %}</a></li>
          <li><a data-toggle="tab" href="#activities-tab">{% trans "Activities" %}</a></li>
          <li><a data-toggle="tab" href="#actors-tab">{% trans "Actors" %}</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade in active" id="description-tab">
            <div class="col-md-12 bordered">
              <div class="row" style="width: 900px; max-width: 100%;">
                <div name="description"><%= description %></div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="ce-diagrams-tab">
            <div class="col-md-12 bordered">
              <div class="col-md-6">
                <div class="row">
                  <h4>{% trans "Current process" %}</h4>
                </div>
                <div style="position: relative;">
                  <div class="row bordered" style="background: white; overflow: auto; min-height: 200px;">
                    <img id="state-image" src='<%= stateSrc %>' style="width: 100%" alt="{% trans "Current process" %}">
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="row">
                  <h4>{% trans "Proposed process" %}</h4>
                </div>
                <div style="position: relative; ">
                  <div class="row bordered" style="background: white; overflow: auto; min-height: 200px;">
                    <img id="effect-image" src='<%= effectSrc %>' style="width: 100%" alt="{% trans "Proposed process" %}">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="activities-tab">
            <div class="col-md-12 bordered">
              <h4>{% trans "Activities involved" %}</h4>
              <div class="col-md-8">
                <div style="position: relative; ">
                  <div class="row bordered" style="background: white; overflow: auto; min-height: 200px;">
                    <img id="activities-image" src='<%= activitiesSrc %>' style="width: 100%" alt="{% trans "Activities involved" %}">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade in" id="actors-tab">
            <div class="col-md-12 bordered">
              <div class="olmap" id='actors-map'>
                <div id='legend' class="bordered workshop">
                  <div class="row" data-toggle="collapse" data-target="#legend>.items">
                    <button class="btn btn-primary square inverted">
                      <span class="glyphicon glyphicon-eye-open"></span>
                    </button>
                    <h4> {% trans "Legend" %} </h4>
                  </div>
                  <div class="items collapse" style="padding: 5px; list-style: none;">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary confirm" data-dismiss="modal" aria-hidden="true">{% trans "OK"%}</button>
    </div>
  </div>
</div>
</script>

{% endblock %}
